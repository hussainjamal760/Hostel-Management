# Hostelite HMS - Complete Implementation Plan

A production-ready, scalable Hostel Management System built with MERN stack + React Native, designed for **OWNER â†’ MANAGER â†’ STUDENT** hierarchy.

---

## User Review Required

> [!IMPORTANT]
> **Technology Stack Decisions** - Please confirm:
> 1. **Database**: MongoDB Atlas (recommended) or self-hosted MongoDB?
> 2. **Payment Gateway**: Stripe, Razorpay, or other regional provider?
> 3. **Push Notifications**: Firebase Cloud Messaging (FCM) for mobile?
> 4. **File Storage**: Cloudinary (images) or AWS S3?
> 5. **SMS/Email Provider**: Twilio/SendGrid for OTP and notifications?

> [!WARNING]
> **Breaking Changes from Your Proposal:**
> 1. Changed file extensions from `.js` to `.ts` throughout (you mentioned TypeScript)
> 2. Added `ADMIN` super-role for platform management (multi-hostel SaaS capability)
> 3. Added `rooms` module (essential for hostel management - room allocation)
> 4. Added `complaints` module (student grievance system)
> 5. Added `notifications` module (in-app + push notifications)
> 6. Split `shared/` into proper npm workspaces for code sharing

---

## Architecture Overview

```mermaid
graph TB
    subgraph "Client Apps"
        WEB[Web Admin<br/>React + Vite + TS]
        MOB[Mobile App<br/>React Native + Expo]
    end
    
    subgraph "Backend Services"
        API[Express API Server<br/>Node.js + TypeScript]
        QUEUE[Bull Queue<br/>Background Jobs]
    end
    
    subgraph "Data Layer"
        MONGO[(MongoDB Atlas)]
        REDIS[(Redis Cache)]
    end
    
    subgraph "External Services"
        FCM[Firebase FCM]
        EMAIL[SendGrid/Nodemailer]
        STORAGE[Cloudinary]
        PAYMENT[Payment Gateway]
    end
    
    WEB --> API
    MOB --> API
    API --> MONGO
    API --> REDIS
    API --> QUEUE
    QUEUE --> EMAIL
    QUEUE --> FCM
    API --> STORAGE
    API --> PAYMENT
```

---

## Role Hierarchy & Permissions

```mermaid
graph TD
    ADMIN[ğŸ” ADMIN<br/>Platform Super Admin]
    OWNER[ğŸ¢ OWNER<br/>Hostel Owner]
    MANAGER[ğŸ‘” MANAGER<br/>Hostel Manager]
    STUDENT[ğŸ“ STUDENT<br/>Hostel Resident]
    
    ADMIN -->|creates/manages| OWNER
    OWNER -->|creates/manages| MANAGER
    MANAGER -->|creates/manages| STUDENT
    
    style ADMIN fill:#e74c3c,color:#fff
    style OWNER fill:#3498db,color:#fff
    style MANAGER fill:#2ecc71,color:#fff
    style STUDENT fill:#f39c12,color:#fff
```

| Role | Capabilities |
|------|-------------|
| **ADMIN** | Platform management, owner CRUD, system analytics, global settings |
| **OWNER** | Hostel CRUD, manager CRUD, financial reports, hostel analytics |
| **MANAGER** | Student CRUD, room allocation, attendance, complaints, daily ops |
| **STUDENT** | View profile, pay fees, check rewards, submit complaints |

---

## Proposed Changes

### Monorepo Structure (Enhanced)

```
hostelite/
â”œâ”€â”€ apps/
â”‚   â”œâ”€â”€ backend/                    # Express + TypeScript API
â”‚   â”œâ”€â”€ web-admin/                  # React + Vite + TypeScript
â”‚   â””â”€â”€ mobile-app/                 # React Native + Expo
â”‚
â”œâ”€â”€ packages/
â”‚   â”œâ”€â”€ shared-types/               # TypeScript interfaces & types
â”‚   â”œâ”€â”€ shared-constants/           # Roles, statuses, enums
â”‚   â”œâ”€â”€ shared-validators/          # Zod schemas (shared validation)
â”‚   â””â”€â”€ shared-utils/               # Common utility functions
â”‚
â”œâ”€â”€ package.json                    # Root package.json (npm workspaces)
â”œâ”€â”€ turbo.json                      # Turborepo config (optional)
â”œâ”€â”€ tsconfig.base.json              # Shared TypeScript config
â”œâ”€â”€ .eslintrc.js                    # Shared ESLint config
â”œâ”€â”€ .prettierrc                     # Prettier config
â””â”€â”€ README.md
```

---

### Backend Structure

#### [NEW] [apps/backend/](file:///d:/hostel-management/apps/backend/)

```
apps/backend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app.ts                      # Express app initialization
â”‚   â”œâ”€â”€ server.ts                   # Server bootstrap + DB connect
â”‚   â”‚
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â”œâ”€â”€ index.ts                # Config aggregator
â”‚   â”‚   â”œâ”€â”€ database.ts             # MongoDB connection config
â”‚   â”‚   â”œâ”€â”€ env.ts                  # Environment validation (envalid)
â”‚   â”‚   â”œâ”€â”€ cors.ts                 # CORS configuration
â”‚   â”‚   â””â”€â”€ logger.ts               # Winston logger setup
â”‚   â”‚
â”‚   â”œâ”€â”€ modules/
â”‚   â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.controller.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.routes.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.service.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.validation.ts  # Zod schemas
â”‚   â”‚   â”‚   â””â”€â”€ auth.types.ts
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ users/
â”‚   â”‚   â”‚   â”œâ”€â”€ user.model.ts       # Mongoose schema
â”‚   â”‚   â”‚   â”œâ”€â”€ user.controller.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ user.routes.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ user.service.ts
â”‚   â”‚   â”‚   â””â”€â”€ user.types.ts
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ hostels/
â”‚   â”‚   â”‚   â”œâ”€â”€ hostel.model.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ hostel.controller.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ hostel.routes.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ hostel.service.ts
â”‚   â”‚   â”‚   â””â”€â”€ hostel.types.ts
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ rooms/                  # NEW: Room management
â”‚   â”‚   â”‚   â”œâ”€â”€ room.model.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ room.controller.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ room.routes.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ room.service.ts
â”‚   â”‚   â”‚   â””â”€â”€ room.types.ts
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ students/
â”‚   â”‚   â”‚   â”œâ”€â”€ student.model.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ student.controller.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ student.routes.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ student.service.ts
â”‚   â”‚   â”‚   â””â”€â”€ student.types.ts
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ payments/
â”‚   â”‚   â”‚   â”œâ”€â”€ payment.model.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ payment.controller.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ payment.routes.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ payment.service.ts
â”‚   â”‚   â”‚   â””â”€â”€ payment.types.ts
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ rewards/
â”‚   â”‚   â”‚   â”œâ”€â”€ reward.model.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ reward.controller.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ reward.routes.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ reward.service.ts
â”‚   â”‚   â”‚   â””â”€â”€ reward.types.ts
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ complaints/             # NEW: Grievance system
â”‚   â”‚   â”‚   â”œâ”€â”€ complaint.model.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ complaint.controller.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ complaint.routes.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ complaint.service.ts
â”‚   â”‚   â”‚   â””â”€â”€ complaint.types.ts
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ notifications/          # NEW: In-app + Push
â”‚   â”‚       â”œâ”€â”€ notification.model.ts
â”‚   â”‚       â”œâ”€â”€ notification.controller.ts
â”‚   â”‚       â”œâ”€â”€ notification.routes.ts
â”‚   â”‚       â”œâ”€â”€ notification.service.ts
â”‚   â”‚       â””â”€â”€ notification.types.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ middlewares/
â”‚   â”‚   â”œâ”€â”€ auth.middleware.ts      # JWT verification
â”‚   â”‚   â”œâ”€â”€ role.middleware.ts      # RBAC enforcement
â”‚   â”‚   â”œâ”€â”€ validate.middleware.ts  # Zod validation
â”‚   â”‚   â”œâ”€â”€ rateLimiter.middleware.ts
â”‚   â”‚   â””â”€â”€ error.middleware.ts     # Global error handler
â”‚   â”‚
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”œâ”€â”€ ApiResponse.ts          # Standardized responses
â”‚   â”‚   â”œâ”€â”€ ApiError.ts             # Custom error class
â”‚   â”‚   â”œâ”€â”€ asyncHandler.ts         # Async wrapper
â”‚   â”‚   â”œâ”€â”€ usernameGenerator.ts
â”‚   â”‚   â”œâ”€â”€ passwordGenerator.ts
â”‚   â”‚   â””â”€â”€ hash.ts                 # bcrypt helpers
â”‚   â”‚
â”‚   â”œâ”€â”€ jobs/                       # NEW: Background jobs
â”‚   â”‚   â”œâ”€â”€ queue.ts                # Bull queue setup
â”‚   â”‚   â”œâ”€â”€ email.job.ts
â”‚   â”‚   â””â”€â”€ notification.job.ts
â”‚   â”‚
â”‚   â””â”€â”€ routes/
â”‚       â””â”€â”€ index.ts                # Route aggregator
â”‚
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ unit/
â”‚   â””â”€â”€ integration/
â”‚
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â”œâ”€â”€ nodemon.json
â””â”€â”€ Dockerfile
```

---

### Database Schemas (Enhanced)

#### User Model
```typescript
// user.model.ts
interface IUser {
  _id: ObjectId;
  username: string;           // Auto-generated: role-hostelCode-seq
  email?: string;             // Optional for students
  phone?: string;             // For OTP login
  password: string;           // bcrypt hashed
  role: 'ADMIN' | 'OWNER' | 'MANAGER' | 'STUDENT';
  hostelId?: ObjectId;        // null for ADMIN, required for others
  createdBy?: ObjectId;       // Who created this user
  isFirstLogin: boolean;      // Force password change
  isActive: boolean;          // Soft delete / ban
  lastLoginAt?: Date;
  refreshToken?: string;      // For token refresh
  fcmToken?: string;          // Push notification token
  avatar?: string;            // Cloudinary URL
  createdAt: Date;
  updatedAt: Date;
}
```

#### Hostel Model
```typescript
// hostel.model.ts
interface IHostel {
  _id: ObjectId;
  name: string;
  code: string;               // Unique 4-char code: "HST1"
  ownerId: ObjectId;          // Reference to owner user
  address: {
    street: string;
    city: string;
    state: string;
    pincode: string;
    coordinates?: {
      lat: number;
      lng: number;
    };
  };
  totalRooms: number;
  totalBeds: number;
  amenities: string[];        // ["WiFi", "AC", "Laundry"]
  images: string[];           // Cloudinary URLs
  monthlyRent: number;        // Base rent
  securityDeposit: number;
  isActive: boolean;
  createdAt: Date;
  updatedAt: Date;
}
```

#### Room Model (NEW)
```typescript
// room.model.ts
interface IRoom {
  _id: ObjectId;
  hostelId: ObjectId;
  roomNumber: string;         // "101", "A-12"
  floor: number;
  roomType: 'SINGLE' | 'DOUBLE' | 'TRIPLE' | 'DORMITORY';
  totalBeds: number;
  occupiedBeds: number;
  rent: number;               // Room-specific rent
  amenities: string[];        // Room-specific amenities
  isActive: boolean;
  createdAt: Date;
  updatedAt: Date;
}
```

#### Student Model
```typescript
// student.model.ts
interface IStudent {
  _id: ObjectId;
  userId: ObjectId;           // Reference to User
  hostelId: ObjectId;
  roomId: ObjectId;
  bedNumber: string;          // "A", "B", "C"
  
  // Personal Info
  fullName: string;
  fatherName: string;
  dateOfBirth: Date;
  gender: 'MALE' | 'FEMALE' | 'OTHER';
  bloodGroup?: string;
  
  // Contact
  emergencyContact: {
    name: string;
    relation: string;
    phone: string;
  };
  permanentAddress: string;
  
  // Academic (optional)
  institution?: string;
  course?: string;
  
  // Hostel Status
  joinDate: Date;
  expectedLeaveDate?: Date;
  feeStatus: 'PAID' | 'PARTIAL' | 'DUE' | 'OVERDUE';
  totalDue: number;
  
  // Gamification
  points: number;
  badges: string[];
  
  // Documents
  idProof?: string;           // Cloudinary URL
  photo?: string;
  
  isActive: boolean;
  createdAt: Date;
  updatedAt: Date;
}
```

#### Payment Model
```typescript
// payment.model.ts
interface IPayment {
  _id: ObjectId;
  studentId: ObjectId;
  hostelId: ObjectId;
  
  amount: number;
  paymentType: 'RENT' | 'SECURITY' | 'FINE' | 'OTHER';
  paymentMethod: 'CASH' | 'UPI' | 'CARD' | 'BANK_TRANSFER';
  
  // For online payments
  transactionId?: string;
  gatewayResponse?: object;
  
  month: number;              // 1-12
  year: number;               // 2024
  
  status: 'PENDING' | 'COMPLETED' | 'FAILED' | 'REFUNDED';
  paidAt?: Date;
  
  collectedBy: ObjectId;      // Manager who collected
  receiptNumber: string;      // Auto-generated
  notes?: string;
  
  createdAt: Date;
  updatedAt: Date;
}
```

#### Reward Model
```typescript
// reward.model.ts
interface IReward {
  _id: ObjectId;
  studentId: ObjectId;
  hostelId: ObjectId;
  
  points: number;             // Can be negative for deductions
  reason: string;
  category: 'CLEANLINESS' | 'PUNCTUALITY' | 'BEHAVIOR' | 'PARTICIPATION' | 'PENALTY';
  
  awardedBy: ObjectId;        // Manager
  awardedAt: Date;
  
  createdAt: Date;
}
```

#### Complaint Model (NEW)
```typescript
// complaint.model.ts
interface IComplaint {
  _id: ObjectId;
  studentId: ObjectId;
  hostelId: ObjectId;
  
  title: string;
  description: string;
  category: 'MAINTENANCE' | 'FOOD' | 'SECURITY' | 'CLEANLINESS' | 'OTHER';
  priority: 'LOW' | 'MEDIUM' | 'HIGH' | 'URGENT';
  
  status: 'OPEN' | 'IN_PROGRESS' | 'RESOLVED' | 'CLOSED';
  
  attachments?: string[];     // Images of issue
  
  assignedTo?: ObjectId;      // Manager handling it
  resolution?: string;
  resolvedAt?: Date;
  
  createdAt: Date;
  updatedAt: Date;
}
```

#### Notification Model (NEW)
```typescript
// notification.model.ts
interface INotification {
  _id: ObjectId;
  userId: ObjectId;
  
  title: string;
  body: string;
  type: 'PAYMENT_DUE' | 'PAYMENT_RECEIVED' | 'REWARD' | 'COMPLAINT_UPDATE' | 'ANNOUNCEMENT';
  
  data?: object;              // Additional payload
  
  isRead: boolean;
  readAt?: Date;
  
  createdAt: Date;
}
```

---

### API Endpoints (Complete)

#### Authentication
| Method | Endpoint | Access | Description |
|--------|----------|--------|-------------|
| POST | `/api/v1/auth/login` | Public | Login with username/password |
| POST | `/api/v1/auth/refresh` | Public | Refresh access token |
| POST | `/api/v1/auth/logout` | Auth | Logout and invalidate refresh |
| POST | `/api/v1/auth/change-password` | Auth | Change password (first login) |
| POST | `/api/v1/auth/forgot-password` | Public | Request password reset |

#### Users
| Method | Endpoint | Access | Description |
|--------|----------|--------|-------------|
| GET | `/api/v1/users/me` | Auth | Get current user profile |
| PATCH | `/api/v1/users/me` | Auth | Update own profile |
| PATCH | `/api/v1/users/me/avatar` | Auth | Upload avatar |
| PATCH | `/api/v1/users/me/fcm-token` | Auth | Update FCM token |

#### Admin Routes
| Method | Endpoint | Access | Description |
|--------|----------|--------|-------------|
| GET | `/api/v1/admin/owners` | ADMIN | List all owners |
| POST | `/api/v1/admin/owners` | ADMIN | Create owner |
| GET | `/api/v1/admin/analytics` | ADMIN | Platform analytics |

#### Owner Routes
| Method | Endpoint | Access | Description |
|--------|----------|--------|-------------|
| GET | `/api/v1/hostels` | OWNER | List own hostels |
| POST | `/api/v1/hostels` | OWNER | Create hostel |
| GET | `/api/v1/hostels/:id` | OWNER | Get hostel details |
| PATCH | `/api/v1/hostels/:id` | OWNER | Update hostel |
| DELETE | `/api/v1/hostels/:id` | OWNER | Deactivate hostel |
| GET | `/api/v1/hostels/:id/managers` | OWNER | List managers |
| POST | `/api/v1/hostels/:id/managers` | OWNER | Create manager |
| GET | `/api/v1/hostels/:id/analytics` | OWNER | Hostel analytics |

#### Manager Routes
| Method | Endpoint | Access | Description |
|--------|----------|--------|-------------|
| GET | `/api/v1/rooms` | MANAGER | List rooms |
| POST | `/api/v1/rooms` | MANAGER | Create room |
| PATCH | `/api/v1/rooms/:id` | MANAGER | Update room |
| GET | `/api/v1/students` | MANAGER | List students |
| POST | `/api/v1/students` | MANAGER | Register student |
| GET | `/api/v1/students/:id` | MANAGER | Get student details |
| PATCH | `/api/v1/students/:id` | MANAGER | Update student |
| DELETE | `/api/v1/students/:id` | MANAGER | Checkout student |
| POST | `/api/v1/payments` | MANAGER | Record payment |
| GET | `/api/v1/payments` | MANAGER | List payments |
| POST | `/api/v1/rewards` | MANAGER | Award/deduct points |
| GET | `/api/v1/complaints` | MANAGER | List complaints |
| PATCH | `/api/v1/complaints/:id` | MANAGER | Update complaint |

#### Student Routes
| Method | Endpoint | Access | Description |
|--------|----------|--------|-------------|
| GET | `/api/v1/students/me` | STUDENT | Get own profile |
| GET | `/api/v1/students/me/payments` | STUDENT | Payment history |
| GET | `/api/v1/students/me/rewards` | STUDENT | Reward history |
| POST | `/api/v1/complaints` | STUDENT | Submit complaint |
| GET | `/api/v1/complaints/me` | STUDENT | My complaints |
| GET | `/api/v1/notifications` | STUDENT | My notifications |
| PATCH | `/api/v1/notifications/:id/read` | Auth | Mark as read |

---

### Web Admin Structure

#### [NEW] [apps/web-admin/](file:///d:/hostel-management/apps/web-admin/)

```
apps/web-admin/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main.tsx
â”‚   â”œâ”€â”€ App.tsx
â”‚   â”œâ”€â”€ vite-env.d.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ assets/
â”‚   â”‚   â”œâ”€â”€ images/
â”‚   â”‚   â””â”€â”€ icons/
â”‚   â”‚
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ ui/                     # Reusable UI components
â”‚   â”‚   â”‚   â”œâ”€â”€ Button.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ Input.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ Modal.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ Table.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ Card.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ Badge.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ Avatar.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ Dropdown.tsx
â”‚   â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ layout/
â”‚   â”‚   â”‚   â”œâ”€â”€ Sidebar.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ Navbar.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ DashboardLayout.tsx
â”‚   â”‚   â”‚   â””â”€â”€ AuthLayout.tsx
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ forms/
â”‚   â”‚   â”‚   â”œâ”€â”€ StudentForm.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ ManagerForm.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ RoomForm.tsx
â”‚   â”‚   â”‚   â””â”€â”€ PaymentForm.tsx
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ charts/
â”‚   â”‚       â”œâ”€â”€ RevenueChart.tsx
â”‚   â”‚       â”œâ”€â”€ OccupancyChart.tsx
â”‚   â”‚       â””â”€â”€ PaymentChart.tsx
â”‚   â”‚
â”‚   â”œâ”€â”€ pages/
â”‚   â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”‚   â”œâ”€â”€ Login.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ ForgotPassword.tsx
â”‚   â”‚   â”‚   â””â”€â”€ ChangePassword.tsx
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ admin/                  # ADMIN role pages
â”‚   â”‚   â”‚   â”œâ”€â”€ Dashboard.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ Owners.tsx
â”‚   â”‚   â”‚   â””â”€â”€ Settings.tsx
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ owner/                  # OWNER role pages
â”‚   â”‚   â”‚   â”œâ”€â”€ Dashboard.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ Hostels.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ HostelDetails.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ Managers.tsx
â”‚   â”‚   â”‚   â””â”€â”€ Analytics.tsx
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ manager/                # MANAGER role pages
â”‚   â”‚   â”‚   â”œâ”€â”€ Dashboard.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ Students.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ StudentDetails.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ Rooms.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ Payments.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ Rewards.tsx
â”‚   â”‚   â”‚   â””â”€â”€ Complaints.tsx
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ student/                # STUDENT role pages
â”‚   â”‚   â”‚   â”œâ”€â”€ Dashboard.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ Profile.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ Payments.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ Rewards.tsx
â”‚   â”‚   â”‚   â””â”€â”€ Complaints.tsx
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ shared/
â”‚   â”‚       â”œâ”€â”€ NotFound.tsx
â”‚   â”‚       â””â”€â”€ Unauthorized.tsx
â”‚   â”‚
â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â”œâ”€â”€ useAuth.ts
â”‚   â”‚   â”œâ”€â”€ useApi.ts
â”‚   â”‚   â””â”€â”€ useNotification.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ api.ts                  # Axios instance
â”‚   â”‚   â”œâ”€â”€ auth.service.ts
â”‚   â”‚   â”œâ”€â”€ user.service.ts
â”‚   â”‚   â”œâ”€â”€ hostel.service.ts
â”‚   â”‚   â”œâ”€â”€ student.service.ts
â”‚   â”‚   â””â”€â”€ payment.service.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ store/                      # Zustand or Redux Toolkit
â”‚   â”‚   â”œâ”€â”€ index.ts
â”‚   â”‚   â”œâ”€â”€ authSlice.ts
â”‚   â”‚   â””â”€â”€ uiSlice.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”œâ”€â”€ index.tsx               # Route definitions
â”‚   â”‚   â”œâ”€â”€ PrivateRoute.tsx
â”‚   â”‚   â””â”€â”€ RoleRoute.tsx           # Role-based route guard
â”‚   â”‚
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”œâ”€â”€ constants.ts
â”‚   â”‚   â”œâ”€â”€ formatters.ts
â”‚   â”‚   â””â”€â”€ validators.ts
â”‚   â”‚
â”‚   â””â”€â”€ styles/
â”‚       â”œâ”€â”€ globals.css
â”‚       â””â”€â”€ variables.css
â”‚
â”œâ”€â”€ public/
â”œâ”€â”€ index.html
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â”œâ”€â”€ vite.config.ts
â””â”€â”€ tailwind.config.js              # If using Tailwind
```

---

### Mobile App Structure

#### [NEW] [apps/mobile-app/](file:///d:/hostel-management/apps/mobile-app/)

```
apps/mobile-app/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ App.tsx
â”‚   â”‚
â”‚   â”œâ”€â”€ screens/
â”‚   â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”‚   â”œâ”€â”€ LoginScreen.tsx
â”‚   â”‚   â”‚   â””â”€â”€ ChangePasswordScreen.tsx
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ admin/
â”‚   â”‚   â”‚   â”œâ”€â”€ DashboardScreen.tsx
â”‚   â”‚   â”‚   â””â”€â”€ OwnersScreen.tsx
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ owner/
â”‚   â”‚   â”‚   â”œâ”€â”€ DashboardScreen.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ HostelsScreen.tsx
â”‚   â”‚   â”‚   â””â”€â”€ ManagersScreen.tsx
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ manager/
â”‚   â”‚   â”‚   â”œâ”€â”€ DashboardScreen.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ StudentsScreen.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ RoomsScreen.tsx
â”‚   â”‚   â”‚   â””â”€â”€ PaymentsScreen.tsx
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ student/
â”‚   â”‚       â”œâ”€â”€ DashboardScreen.tsx
â”‚   â”‚       â”œâ”€â”€ ProfileScreen.tsx
â”‚   â”‚       â”œâ”€â”€ PaymentsScreen.tsx
â”‚   â”‚       â”œâ”€â”€ RewardsScreen.tsx
â”‚   â”‚       â””â”€â”€ ComplaintsScreen.tsx
â”‚   â”‚
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ ui/
â”‚   â”‚   â”œâ”€â”€ cards/
â”‚   â”‚   â””â”€â”€ forms/
â”‚   â”‚
â”‚   â”œâ”€â”€ navigation/
â”‚   â”‚   â”œâ”€â”€ RootNavigator.tsx
â”‚   â”‚   â”œâ”€â”€ AuthNavigator.tsx
â”‚   â”‚   â”œâ”€â”€ AdminNavigator.tsx
â”‚   â”‚   â”œâ”€â”€ OwnerNavigator.tsx
â”‚   â”‚   â”œâ”€â”€ ManagerNavigator.tsx
â”‚   â”‚   â””â”€â”€ StudentNavigator.tsx
â”‚   â”‚
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â””â”€â”€ api.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ store/
â”‚   â”‚   â”œâ”€â”€ index.ts
â”‚   â”‚   â””â”€â”€ authSlice.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â”œâ”€â”€ useAuth.ts
â”‚   â”‚   â””â”€â”€ useNotification.ts
â”‚   â”‚
â”‚   â””â”€â”€ utils/
â”‚       â””â”€â”€ storage.ts              # AsyncStorage helpers
â”‚
â”œâ”€â”€ app.json
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â”œâ”€â”€ babel.config.js
â””â”€â”€ metro.config.js
```

---

### Shared Packages

#### [NEW] [packages/shared-types/](file:///d:/hostel-management/packages/shared-types/)

```typescript
// packages/shared-types/src/index.ts
export * from './user.types';
export * from './hostel.types';
export * from './student.types';
export * from './payment.types';
export * from './api.types';
```

#### [NEW] [packages/shared-constants/](file:///d:/hostel-management/packages/shared-constants/)

```typescript
// packages/shared-constants/src/roles.ts
export const ROLES = {
  ADMIN: 'ADMIN',
  OWNER: 'OWNER',
  MANAGER: 'MANAGER',
  STUDENT: 'STUDENT',
} as const;

export type Role = typeof ROLES[keyof typeof ROLES];
```

#### [NEW] [packages/shared-validators/](file:///d:/hostel-management/packages/shared-validators/)

```typescript
// packages/shared-validators/src/auth.validation.ts
import { z } from 'zod';

export const loginSchema = z.object({
  username: z.string().min(3),
  password: z.string().min(6),
});

export type LoginInput = z.infer<typeof loginSchema>;
```

---

## Verification Plan

### Automated Tests

1. **Backend Unit Tests**
   ```bash
   cd apps/backend && npm run test:unit
   ```
   - Test all service methods
   - Test middleware functions
   - Test utility functions

2. **Backend Integration Tests**
   ```bash
   cd apps/backend && npm run test:integration
   ```
   - Test API endpoints with real DB
   - Test authentication flow
   - Test role-based access

3. **Web Admin Tests**
   ```bash
   cd apps/web-admin && npm run test
   ```
   - Component unit tests
   - Hook tests
   - E2E with Playwright (optional)

### Manual Verification

1. **Authentication Flow**
   - Login as each role
   - Verify first-login password change
   - Test token refresh
   - Test logout

2. **Role-Based Access**
   - Verify OWNER can only see own hostels
   - Verify MANAGER can only manage assigned hostel
   - Verify STUDENT can only see own data

3. **Core Flows**
   - Owner creates hostel â†’ assigns manager
   - Manager registers student â†’ assigns room
   - Student pays fee â†’ receives points
   - Student submits complaint â†’ manager resolves

---

## Development Roadmap

### Phase 1: Foundation (Week 1)
- [ ] Monorepo setup with npm workspaces
- [ ] Backend boilerplate with TypeScript
- [ ] Database connection and models
- [ ] Authentication system complete

### Phase 2: Core Backend (Week 2)
- [ ] All CRUD operations
- [ ] Role-based middleware
- [ ] API documentation (Swagger)
- [ ] Unit tests for services

### Phase 3: Web Admin (Week 3)
- [ ] UI component library
- [ ] Authentication pages
- [ ] Owner dashboard
- [ ] Manager dashboard
- [ ] Student portal

### Phase 4: Mobile App (Week 4)
- [ ] Navigation setup
- [ ] Authentication screens
- [ ] Role-based dashboards
- [ ] Push notifications

### Phase 5: Polish & Deploy (Week 5)
- [ ] Testing & bug fixes
- [ ] Performance optimization
- [ ] CI/CD pipeline
- [ ] Production deployment

---

## Technology Stack Summary

| Layer | Technology |
|-------|------------|
| **Backend Runtime** | Node.js 20 LTS |
| **Backend Framework** | Express.js 4.x |
| **Language** | TypeScript 5.x |
| **Database** | MongoDB 7.x (Atlas) |
| **ODM** | Mongoose 8.x |
| **Validation** | Zod |
| **Auth** | JWT (jsonwebtoken + bcrypt) |
| **Web Frontend** | React 18 + Vite |
| **State Management** | Zustand or Redux Toolkit |
| **Mobile** | React Native + Expo SDK 50 |
| **Styling (Web)** | Tailwind CSS or CSS Modules |
| **Styling (Mobile)** | NativeWind or StyleSheet |
| **Testing** | Vitest + React Testing Library |
| **API Docs** | Swagger (swagger-jsdoc) |

---

> [!TIP]
> This architecture supports:
> - **Multi-tenancy**: Multiple owners with multiple hostels
> - **Horizontal scaling**: Stateless backend, Redis sessions
> - **Mobile-first**: API designed for mobile consumption
> - **Investor-ready**: Clean separation of concerns, testable code
